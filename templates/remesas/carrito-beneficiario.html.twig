{% extends 'base.html.twig' %}

{% block content %}
{% include 'breadcrumbs.html.twig' %}
<!-- Section Input Groups-->
<section class="section novi-background section-20" id="seccion-principal">
	<div class="container">

		<div class="container card">
			<img class="imagen-cliente" src="/images/iconos/user.svg">
			<div class="card-header text-center">
				<h1>Datos del Beneficiario</h1>
				<hr class="divider-white bg-mantis-white">
			</div>

			<div class="row justify-content-md-center no-margin">
				<div class="col col-lg-2"></div>
				<div class="col-md-auto">
					<div id="messageBox" style="margin: 25px; display: none;" class="alert alert-danger" role="alert"></div>
				</div>
				<div class="col col-lg-2"></div>
			</div>

			<form name="cliente_beneficiario" method="post" id="form_add_beneficiario" novalidate="novalidate">

				<h5 style="color:white;">Beneficiario</h5>
				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.primerNombre}}" type="text" id="cliente_beneficiario_primerNombre" name="cliente_beneficiario[primerNombre]" required="required" maxlength="255" class="fomulario form-control" placeholder=" Nombre">
						<input value="{{beneficiario.primerApellido}}" type="text" id="cliente_beneficiario_primerApellido" name="cliente_beneficiario[primerApellido]" required="required" maxlength="255" class="fomulario form-control" placeholder="Apellido">
						<input value="{{beneficiario.segundoApellido}}" type="text" id="cliente_beneficiario_segundoApellido" name="cliente_beneficiario[segundoApellido]" maxlength="255" class="fomulario form-control" placeholder="Segundo Apellido">
						<span class="input-group-append"></span>
					</div>
				</div>

				<h5 style="color:white;">
					Alternativo</h5>
				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.alternativoNombre}}" type="text" id="cliente_beneficiario_alternativoNombre" name="cliente_beneficiario[alternativoNombre]" maxlength="255" class="fomulario form-control" placeholder="Alternativo Nombre Alternativo">
						<input value="{{beneficiario.alternativoApellido}}" type="text" id="cliente_beneficiario_alternativoApellido" name="cliente_beneficiario[alternativoApellido]" maxlength="255" class="fomulario form-control" placeholder=" Alternativo Primer Apellido ">
						<input value="{{beneficiario.alternativoSegundoApellido}}" type="text" id="cliente_beneficiario_alternativoSegundoApellido" name="cliente_beneficiario[alternativoSegundoApellido]" maxlength="255" class="fomulario form-control" placeholder=" Alternativo Segundo Apellido ">
						<span class="input-group-append"></span>
					</div>
				</div>

				<h5 style="color:white;">Contactos</h5>
				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.telefono}}" type="text" id="cliente_beneficiario_telefono" name="cliente_beneficiario[telefono]" required="required" maxlength="255" class="fomulario form-control" placeholder="Celular">
						<input value="{{beneficiario.telefonoCasa}}" type="text" id="cliente_beneficiario_telefonoCasa" name="cliente_beneficiario[telefonoCasa]" maxlength="255" class="fomulario form-control" placeholder="Telefono Adicional">
						<input value="{{beneficiario.identificacion}}" type="text" id="cliente_beneficiario_identificacion" name="cliente_beneficiario[identificacion]" maxlength="255" class="fomulario form-control" placeholder="Identificacion">

						<span class="input-group-append"></span>
					</div>
				</div>

				<h5 style="color:white;">Direcci√≥n</h5>
				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.calle}}" type="text" id="cliente_beneficiario_calle" name="cliente_beneficiario[calle]" required="required" maxlength="255" class="fomulario form-control" placeholder="Calle">
						<input value="{{beneficiario.entre}}" type="text" id="cliente_beneficiario_entre" name="cliente_beneficiario[entre]" maxlength="255" class="fomulario form-control" placeholder="Entre">
						<input value="{{beneficiario.y}}" type="text" id="cliente_beneficiario_y" name="cliente_beneficiario[y]" maxlength="255" class="fomulario form-control" placeholder="Y">

						<span class="input-group-append"></span>
					</div>
				</div>

				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.no}}" type="text" id="cliente_beneficiario_no" name="cliente_beneficiario[no]" required="required" maxlength="255" class="fomulario form-control" placeholder="No">
						<input value="{{beneficiario.edificio}}" type="text" id="cliente_beneficiario_edificio" name="cliente_beneficiario[edificio]" maxlength="255" class="fomulario form-control" placeholder="Edificio">
						<input value="{{beneficiario.apto}}" type="text" id="cliente_beneficiario_apto" name="cliente_beneficiario[apto]" maxlength="255" class="fomulario form-control" placeholder="Apartamento">
						<span class="input-group-append"></span>
					</div>
				</div>

				<div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.reparto}}" type="text" id="cliente_beneficiario_reparto" name="cliente_beneficiario[reparto]" maxlength="255" class="fomulario form-control" placeholder="Reparto">

						<select id="cliente_beneficiario_provincias" name="provincias" class="fomulario form-control valid" aria-invalid="false">

							<option value="0">Provincias</option>
							<option value="21">PINAR DEL RIO</option>
							<option value="22">ARTEMISA</option>
							<option value="23">LA HABANA</option>
							<option value="24">MAYABEQUE</option>
							<option value="25">MATANZAS</option>
							<option value="26">VILLA CLARA</option>
							<option value="27">CIENFUEGOS</option>
							<option value="28">SANCTI SPIRITUS</option>
							<option value="29">CIEGO DE AVILA</option>
							<option value="30">CAMAGUEY</option>
							<option value="31">LAS TUNAS</option>
							<option value="32">HOLGUIN</option>
							<option value="33">GRANMA</option>
							<option value="34">SANTIAGO DE CUBA</option>
							<option value="35">GUANTANAMO</option>

						</select>

						<select id="cliente_beneficiario_municipios" name="municipios" class="fomulario form-control error" aria-invalid="true">

							<option value="0">Municipios</option>
						</select>
						<span class="input-group-append"></span>
					</div>
				</div>

                <div class="form-group">
					<div class="input-group input-group-sm">

						<input value="{{beneficiario.monto}}" type="text" id="total" name="pagar" required="required" maxlength="255" class="fomulario form-control" placeholder="A Pagar">
						<input type="text" id="monto" name="recibir" maxlength="255" class="fomulario form-control" placeholder="Recibir">
						
					</div>
				</div>

			</form>
		</div>
		<div class="row justify-content-md-center group offset-top-34 row-continuar">
			<button id="editBeneficiario" class="btn btn-sm btn-outline-dark" >Editar Beneficiario</button>
		</div>
	
		<div></div>
	</div>
</section>

<style>

.fomulario{

margin-right: 25px;

}

.no-margin{margin: 0px;}

form#form_add_beneficiario {
    padding-right: 15%;
    padding-left: 15%;
}

</style>
						{% endblock %}

{% block javascripts %} 
{{parent()}}

<script>

let codeProvincia = {{beneficiario.provincia}};
let codeMunicipio = {{beneficiario.municipio}};



$( document ).ready(function() {

	total();

	let provinciaNombre = $( "#cliente_beneficiario_provincias  option:selected" ).text();

	if(provinciaNombre == "LA HABANA"){

	}

   $('#cliente_beneficiario_provincias option[value="'+codeProvincia+'"]').attr("selected",true);
   let code = $('#cliente_beneficiario_provincias').find('option:selected').val() 
   let municipio = codeMunicipio;
$.ajax({
            type: 'POST',
            data: {'code' : code},
            url: window.location.protocol+"//"+location.hostname+":"+window.location.port+"/remesas.municipios",
            dataType: 'html',
            success: function (data) {

			
     $('#cliente_beneficiario_municipios')
    .find('option')
    .remove()
    .end()
    .append('<option value="0">Municipios</option>')
    .val('0');

				data = JSON.parse(data);
					
			for(let i = 0; i < data.length; i++) {

				if(municipio != data[i].code){

					 $('#cliente_beneficiario_municipios').append("<option value="+ "'" +data[i].code+"'"+">"+data[i].nombre+"</option>");
			
				}else{
						 $('#cliente_beneficiario_municipios').append("<option selected value="+ "'" +data[i].code+"'"+">"+data[i].nombre+"</option>");
				}
          
                         }          
            }
        });

});


$( "#cliente_beneficiario_provincias" ).change(function() {

let code = $('#cliente_beneficiario_provincias').find('option:selected').val() 

$.ajax({
            type: 'POST',
            data: {'code' : code},
            url: window.location.protocol+"//"+location.hostname+":"+window.location.port+"/remesas.municipios",
            dataType: 'html',
            success: function (data) {

			
     $('#cliente_beneficiario_municipios')
    .find('option')
    .remove()
    .end()
    .append('<option value="0">Municipios</option>')
    .val('0');

				data = JSON.parse(data);
							
			for(let i = 0; i < data.length; i++) {
           $('#cliente_beneficiario_municipios').append("<option value="+ "'" +data[i].code+"'"+">"+data[i].nombre+"</option>");
                         }          
            }
        });

});


$.validator.addMethod("valueNotEquals", function(value, element, arg){
  return arg !== value;
 }, "");

 let validator = $("#form_add_beneficiario").validate({
   errorLabelContainer: "#messageBox",
    wrapper: "li",
    rules: {
      'cliente_beneficiario[primerNombre]': {
      required: true, minlength: 3},
	   'cliente_beneficiario[primerApellido]': {
      required: true, minlength: 3},
	  'cliente_beneficiario[telefono]': {
      required: true, minlength: 8},

	  'cliente_beneficiario[calle]': {
      required: true, minlength: 3},
     
      'total': {
      required: true, minlength: 2},
      
       'recibir': {
      required: true, minlength: 2},

	   'cliente_beneficiario[no]': {
      required: true, minlength: 1},

	  'provincias': {valueNotEquals: "0"},	
	  'municipios': {valueNotEquals: "0"},	

    },
    messages: { 
      'cliente_beneficiario[primerNombre]': {required: "Primer Nombre Requerido", minlength: "Primer Nombre Minimo 3 Caracteres" },
	  'cliente_beneficiario[primerApellido]': {required: "Primer Apellido Requerido", minlength: "Primer Apellido Minimo 3 Caracteres" },
	  'cliente_beneficiario[telefono]': {required: "Telefono Requerido", minlength: "Telefono Minimo 8 Caracteres" },
	  'cliente_beneficiario[calle]': {required: "Calle Requerida", minlength: "Calle Minimo 3 Caracteres" },
	  'cliente_beneficiario[no]': {required: "No. Requerido", minlength: "No Minimo 1 Caracteres" },
      'total': {required: "Total. Requerido", minlength: "No Minimo 2 Caracteres" },
      'recibir': {required: "Monto. Requerido", minlength: "No Minimo 2 Caracteres" },
	  'provincias': {valueNotEquals: "Elije una Provincia."},
	  'municipios': {valueNotEquals: "Elije una Municipio."}
	  },
 
 });

 $('#cliente_beneficiario_no').on('input', function () { 
    this.value = this.value.replace(/[^0-9]/g,'');
});  

 $('#cliente_beneficiario_telefono').on('input', function () { 
    this.value = this.value.replace(/[^0-9]/g,'');
});  

 $('#cliente_beneficiario_telefonoCasa').on('input', function () { 
    this.value = this.value.replace(/[^0-9]/g,'');
});  


$( "#monto" ).change(function() {
				
				if($( "#monto" ).val() <= 100){
								
				if($("#provincia").text() == 'LA HABANA'){

					$( "#total" ).val(Number($( "#monto" ).val()) + Number(5));
				
					}else{ 
									
					$( "#total" ).val(Number($( "#monto" ).val()) + Number(8));
				
				}}else{ 
				
					if($("#provincia").text() == 'LA HABANA'){

					$( "#total" ).val(Number($( "#monto" ).val()) +(Number($( "#monto" ).val()) *0.05 ));
				
					}else{ 
									
					$( "#total" ).val(Number($( "#monto" ).val()) +(Number($( "#monto" ).val()) *0.08 ));

				}}

            });


			$( "#total" ).change(function() {

				total();

            });

			function total(){

					if($( "#total" ).val() <= 100){
								
				if($("#provincia").text() == 'LA HABANA'){

					$( "#monto" ).val(Number($( "#total" ).val()) - Number(5));
				
					}else{ 
									
					$( "#monto" ).val(Number($( "#total" ).val()) - Number(8));
				
				}}else{ 
				
					if($("#provincia").text() == 'LA HABANA'){

					$( "#monto" ).val(Number($( "#total" ).val()) - (Number($( "#total" ).val()) *0.05 ));
				
					}else{ 
									
					$( "#monto" ).val(Number($( "#total" ).val()) - (Number($( "#total" ).val()) *0.08 ));

				}}

			}
$( "#editBeneficiario" ).click(function() {
 
let respuestaForm =  validator.form();

if(respuestaForm){

	let idCarrito = {{id}};

	let array = {};

	array['id'] = {{beneficiario.id}};
	array['primerNombre'] = ($( "#cliente_beneficiario_primerNombre" ).val() == "") ? null : $( "#cliente_beneficiario_primerNombre" ).val();
	array['primerApellido'] = ($( "#cliente_beneficiario_primerApellido" ).val() == "") ? null : $( "#cliente_beneficiario_primerApellido" ).val();
	array['segundoApellido'] = ($( "#cliente_beneficiario_segundoApellido" ).val() == "") ? null : $( "#cliente_beneficiario_segundoApellido" ).val();
	array['identificacion'] = ($( "#cliente_beneficiario_identificacion" ).val() == "") ? null :$( "#cliente_beneficiario_identificacion" ).val();
	array['telefono'] = ($( "#cliente_beneficiario_telefono" ).val() == "") ? null : $( "#cliente_beneficiario_telefono" ).val();
	array['telefonoCasa'] = ($( "#cliente_beneficiario_telefonoCasa" ).val() == "") ? null : $( "#cliente_beneficiario_telefonoCasa" ).val();
	array['alternativoNombre'] = ($( "#cliente_beneficiario_alternativoNombre" ).val() == "") ? null : $( "#cliente_beneficiario_alternativoNombre" ).val();
	array['alternativoApellido'] = ($( "#cliente_beneficiario_alternativoApellido" ).val() == "") ? null : $( "#cliente_beneficiario_alternativoApellido" ).val() ;
	array['alternativoSegundoApellido'] = ($( "#cliente_beneficiario_alternativoSegundoApellido" ).val() == "" ) ? null : $( "#cliente_beneficiario_alternativoSegundoApellido" ).val() ;
	array['calle'] = ($( "#cliente_beneficiario_calle" ).val() == "") ? null : $( "#cliente_beneficiario_calle" ).val() ;
	array['no'] = ($( "#cliente_beneficiario_no" ).val() == "") ? null : $( "#cliente_beneficiario_no" ).val();
	array['entre'] = ($( "#cliente_beneficiario_entre" ).val() == "") ? null : $( "#cliente_beneficiario_entre" ).val() ;
	array['y'] = ($( "#cliente_beneficiario_y" ).val() == "") ? null :  $( "#cliente_beneficiario_y" ).val();
	array['apto'] = ($( "#cliente_beneficiario_apto" ).val() == "") ? null : $( "#cliente_beneficiario_apto" ).val();
	array['edificio'] = ($( "#cliente_beneficiario_edificio" ).val() == "") ? null : $( "#cliente_beneficiario_edificio" ).val() ;
	array['reparto'] = ($( "#cliente_beneficiario_reparto" ).val() == "") ? null : $( "#cliente_beneficiario_reparto" ).val();
	array['provincia'] = $( "#cliente_beneficiario_provincias  option:selected" ).val();
	array['municipio'] = $( "#cliente_beneficiario_municipios  option:selected" ).val();
	array['idCliente'] = "{{beneficiario.idCliente}}";
	array['fecha'] = "{{beneficiario.fecha}}";
	array['empleado'] = "{{beneficiario.empleado}}";
	array['monto'] = $( "#total" ).val();
	array['servicio'] = 'Remesa';
	array['orden'] = "{{beneficiario.orden}}";

  let jsonString = JSON.stringify(array);

  $.ajax({
            type: 'POST',
            data: {'json' : jsonString},
            url: window.location.protocol+"//"+location.hostname+":"+window.location.port+"/remesas.json.editar.save/"+idCarrito,
            dataType: 'html',
            success: function (data) {
				
				 window.location.href = "/remesas.beneficiarios/"+"{{beneficiario.idCliente}}";
            }
        });


}

});

			


 </script>

{% endblock %}

