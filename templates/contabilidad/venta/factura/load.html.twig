{% extends 'base.html.twig' %}
{% block content %}

    <div class="container d-flex justify-content-center">
        <div class="card mt-1" style="width: 50rem;">
            <div class="container">
                <div class="row mt-0 p-0">
                    <div class="col-8">
                        <h1 class="text-reporte text-right mr-0">Factura </h1>
                    </div>
                    <div class="col-4 mt-0 px-0 d-flex align-items-center">
                        <span class="h5 text-light m-0 mr-2">#</span>
                        <input type="text" name="nro_factura" id="nro_factura" value="{{ factura.nro_factura }}"
                               class="w-25">
                    </div>
                </div>
            </div>

            {# --------- Datos de la venta --------------#}

            <div class="card-body">
                <div class="row mt-0 p-0">
                    <div class="col-3 mt-0 pl-3 pr-0 form-group input-group input-group-sm d-block">
                        <label>Fecha de la factura</label>
                        <input type="text" value="{{ factura.fecha_factura }}" readonly class="w-100 form-control">
                    </div>
                    <div class="col-3 mt-0 pl-3 pr-0 form-group input-group input-group-sm d-block">
                        <label>Tipo cliente</label>
                        <input type="text" value="{{ factura.tipo_cliente }}" readonly class="w-100 form-control">
                    </div>
                    <div class="col-6 mt-0 pl-3 form-group input-group input-group-sm d-block">
                        <label>Cliente</label>
                        <input type="text" value="{{ factura.cliente }}" readonly class="w-100 form-control">
                    </div>
                </div>
                <div class="row mt-0 p-0 mb-3">
                    <div class="col-12 mt-0 pl-3 form-group input-group input-group-sm d-block">
                        <label>Contrato</label>
                        <input type="text" value="{{ factura.contrato }}" readonly class="w-100 form-control">
                    </div>
                </div>
                <div class="row mt-0 p-0">
                    <div class="col-6 mt-0 pl-3 form-group input-group input-group-sm d-block">
                        <label>Cuenta obligación</label>
                        <input type="text" value="{{ factura.cuenta_obligacion }}" readonly class="w-100 form-control">
                    </div>
                    <div class="col-6 mt-0 pl-0 form-group input-group input-group-sm d-block">
                        <label>Subcuenta obligación</label>
                        <input type="text" value="{{ factura.subcuenta_obligacion }}" readonly
                               class="w-100 form-control">
                    </div>
                </div>

                {# --------- Venta de Mercancias o Productos --------------#}

                <div class="d-flex align-items-center mt-3 pl-2">
                    <h3 class="text-light mr-auto" style="font-weight: 300;">Mercancias o Productos</h3>
                    <div class="px-2" style="background: dimgray; border-radius: .3rem;">
                        <span class="pr-1">Importe Total : {{ importe_total|number_format(2) }} </span>
                    </div>
                </div>
                <hr color="dimgray" class="my-1 ml-2" size=3>
                <div class="mt-3">
                    <table class="table-small-rows table table-hover text-light">
                        <thead class="thead-dark">
                        <th style="width: 85px;">Tipo</th>
                        <th style="width: 50px;">Codigo</th>
                        <th>Cantidad</th>
                        <th>Precio</th>
                        <th>Desc./Rec.</th>
                        <th>Importe</th>
                        <th scope="col-1">Nueva Exist</th>
                        </thead>
                        <tbody>
                        {% for mercancia in mercancias %}
                            <tr>
                                {% if mercancia.mercancia %}
                                    <td style="width: 85px; font-weight: 400"> Mercancía</td>
                                {% else %}
                                    <td style="width: 85px; font-weight: 400"> Producto</td>
                                {% endif %}
                                <td style="width: 50px; text-align: center;"> {{ mercancia.codigo }}</td>
                                <td style="text-align: center;"> {{ mercancia.cantidad }}</td>
                                <td style="text-align: right;"> {{ mercancia.precio|number_format(2) }}</td>
                                <td style="text-align: right;"> {{ mercancia.descuentoRecarga|number_format(2) }}</td>
                                <td style="text-align: right;"> {{ (mercancia.cantidad * mercancia.precio)|number_format(2) }}</td>
                                <td style="text-align: right;"> {{ mercancia.existencia|number_format(2) }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="d-flex mt-2">
                    <div class="mr-auto">
                        <a href="{{ url('venta') }}"
                           class="btn btn-outline-secondary" id="btn_salir">Salir</a>
                    </div>
                    <div class="ml-2">
                        <button class='my-0 btn btn-secondary' id="btnCancelar" onclick="myOnDeleteConfirm()">cancelar
                        </button>
                    </div>
                    <div class="ml-2">
                        <a href="{{ url('print_factura',{nro: factura.nro_factura}) }}" target="_blank"
                           class="btn btn-secondary" id="btn_salir">imprimir</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script>

        /** cancelar la factura */
        const myOnDeleteConfirm = function () {
            const txt_nroFactura = $('#nro_factura')

            $('#confirm__modal').modal('show')
            $('#confirm__modal__title').html('Cancelar')
            $('#confirm__modal__body').text('Está seguro que desea cancelar la factura Nro.' + txt_nroFactura.val() + '?')

            $('#_token__confirm__modal').val($('#__token').val())

            $('#confirm__modal__btn_ok').click(function () {
                const form = $('#form__confirm__modal')
                $('#confirm__modal').modal('hide')
                loadingModal.show('Cancelando...')
                let url = '/contabilidad/venta/factura/delete/' + txt_nroFactura.val()
                form.attr('action', url)
                form.submit()
            })
        }

        $(document).ready(function () {

            /**
             *  ------------------------- Init -----------------------------------------
             */

            const txt_nroFactura = $('#nro_factura')

            /** cargar otras facturas */
            txt_nroFactura.on('keyup', function (event) {
                if (event.which == 13) {
                    loadingModal.show()
                    window.location.replace('/contabilidad/venta/factura/' + $(this).val())
                }
            })

            /** imprimir facturas */
            function Print_Vale() {
                alert('imprimir')
            }

        })

    </script>
{% endblock %}
