{% extends 'base.html.twig' %}

{% block title %}Turismo | Gestión Consular{% endblock %}

{% block content %}
    <div class="container d-flex justify-content-center">
        <div class="card mt-1" style="width: 50rem;">
            <div class="container">
                <h2 class="text-reporte text-center mr-0 text-white mt-2" id="normal_div">
                    Configuración del Precio de Venta del Servicio
                </h2>
            </div>

            <div class="card-body">
                {{ form_start(formulario, {'attr':{'id':'form_precioVenta','autocomplete':"off"}}) }}
                <div class="row mt-0 p-0" id="cuenta_subcuenta_select">
                    <div class="col-4 form-group input-group input-group-sm pa-2 d-block">
                        {{ form_label(formulario.identificador_servicio) }}
                        {{ form_widget(formulario.identificador_servicio) }}
                    </div>
                    <div class="col-4 mt-0 form-group input-group input-group-sm pa-2 d-block">
                        {{ form_label(formulario.prociento) }}
                        {{ form_widget(formulario.prociento) }}
                    </div>
                    <div class="col-4 mt-0 form-group input-group input-group-sm d-block p-0">
                        {{ form_label(formulario.valor_fijo) }}
                        {{ form_widget(formulario.valor_fijo) }}
                    </div>
                </div>
                <div class="d-flex align-items-center mt-3 pl-2">
                    <h3 class="text-light mr-auto" style="font-weight: 300;">Creditos de la venta del Servicio</h3>
                    <div class="px-2" style="background: dimgray; border-radius: .3rem; vertical-align: auto">
                        <label for="owner_client">Precio de Venta:0.00</label>
                    </div>
                </div>
                <hr color="dimgray" class="my-1 ml-2" size=3>
                <div class="row mt-0 p-0" id="cuenta_subcuenta_select">
                    <div class="col-4 form-group input-group input-group-sm pa-2 d-block">
                        {{ form_label(formulario.credito.identificador_servicio) }}
                        {{ form_widget(formulario.credito.identificador_servicio) }}
                    </div>
                    <div class="col-3 mt-0 form-group input-group input-group-sm pa-2 d-block">
                        {{ form_label(formulario.credito.importe) }}
                        {{ form_widget(formulario.credito.importe) }}
                    </div>
                    <div class="col-3 mt-0 form-group input-group input-group-sm d-block p-0">
                        {{ form_label(formulario.credito.credito) }}
                        {{ form_widget(formulario.credito.credito) }}
                    </div>
                    <div class="col-2 pt-2 pl-1 mt-4">
                        <button class="btn btn-secondary btn-sm ml-4" type="button" id="btnAplicarMercancia">ADICIONAR
                        </button>
                    </div>
                </div>
                {{ form_end(formulario) }}
            </div>
            <div>
                <table class="table-small-rows table table-hover text-light">
                    <thead class="thead-dark">
                    <th width="120px">Servicio</th>
                    <th width="120px">Importe</th>
                    <th width="130px">Credito</th>
                    <th width="60px"><i class="fa fa-minus-circle text-danger"></i></th>
                    </thead>
                    <tbody id="rows_solicitudes">
                    </tbody>
                </table>
            </div>
            <div class="d-flex mt-2">
                <div class="mr-auto">
                    <a href="{{ url('turismo_module') }}"
                       class="btn btn-outline-secondary">Salir</a>
                </div>
                <div class="ml-2">
                    <button class='my-0 btn btn-secondary' id="btnSubbmitInforme">Aceptar</button>
                </div>
            </div>
        </div>
    </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
{#    <script>#}
{#        let lista_mercancias = []#}
{#        let importe_total = 0#}
{#        const form_solicitud = $('#form_solicitud')#}
{#        const listado_solicitantes = $('#rows_solicitudes')#}

{#        function resetFormSolicitud() {#}
{#            $('#solicitud_nombre').val('')#}
{#            $('#solicitud_primer_apellido').val('')#}
{#            $('#solicitud_segundo_apellido').val('')#}
{#            $('#solicitud_telefono_celular').val('')#}
{#            $('#solicitud_telefono_fijo').val('')#}
{#            $('#owner_client').prop('checked',false)#}
{#            $('#solicitud_nombre').prop('disabled', false)#}
{#            $('#solicitud_primer_apellido').prop('disabled', false)#}
{#            $('#solicitud_segundo_apellido').prop('disabled', false)#}
{#            $('#solicitud_telefono_celular').prop('disabled', false)#}
{#            $('#solicitud_telefono_fijo').prop('disabled', false)#}
{#        }#}

{#        $('#owner_client').on('change', function () {#}
{#            if ($(this).is(':checked')) {#}
{#                let nombre = $('#nombre').val()#}
{#                let apellidos = $('#apellidos').val().split(' ');#}
{#                let primer_apellido = apellidos[0]#}
{#                let segundo_apellido = apellidos[1]#}
{#                $('#solicitud_nombre').val(nombre)#}
{#                $('#solicitud_primer_apellido').val(primer_apellido)#}
{#                $('#solicitud_segundo_apellido').val(segundo_apellido)#}
{#                $('#solicitud_telefono_celular').val($('#telefono').val())#}
{#                $('#solicitud_telefono_fijo').val('')#}

{#                $('#solicitud_nombre').prop('disabled', true)#}
{#                $('#solicitud_primer_apellido').prop('disabled', true)#}
{#                $('#solicitud_segundo_apellido').prop('disabled', true)#}
{#                $('#solicitud_telefono_celular').prop('disabled', true)#}
{#                $('#solicitud_telefono_fijo').prop('disabled', true)#}
{#            } else {#}
{#                resetFormSolicitud()#}
{#            }#}
{#        })#}

{#        form_solicitud.validate({#}
{#            errorClass: 'invalid-label-orange',#}
{#            errorPlacement: function (error, element) {#}
{#                error.attr('style', 'font-size: .8rem;')#}
{#                error.insertAfter(element);#}
{#            },#}
{#            rules: {#}
{#                'solicitud[nombre]': "required",#}
{#                'solicitud[primer_apellido]': "required",#}
{#            },#}
{#            messages: {#}
{#                'solicitud[nombre]': '!Obligatorio',#}
{#                'solicitud[primer_apellido]': '!Obligatorio',#}
{#            }#}
{#        })#}


{#        $('#btnAplicarMercancia').on('click', function () {#}
{#            if (form_solicitud.valid()) {#}
{#                const nombre = $('#solicitud_nombre').val()#}
{#                const primer_apellido = $('#solicitud_primer_apellido').val()#}
{#                const segundo_apellido = $('#solicitud_segundo_apellido').val()#}
{#                const telefono_celular = $('#solicitud_telefono_celular').val()#}
{#                const telefono_fijo = $('#solicitud_telefono_fijo').val()#}

{#                if (telefono_celular != '' || telefono_fijo != '') {#}
{#                    lista_mercancias.push({#}
{#                        nombre,#}
{#                        primer_apellido,#}
{#                        segundo_apellido,#}
{#                        telefono_celular,#}
{#                        telefono_fijo#}
{#                    })#}
{#                    listado_solicitantes.append(`<tr>#}
{#                        <td class="text-center"> ${nombre}</td>#}
{#                        <td class="text-right"> ${primer_apellido} </td>#}
{#                        <td class="text-right"> ${segundo_apellido} </td>#}
{#                        <td class="text-right"> ${telefono_celular} </td>#}
{#                        <td class="text-right"> ${telefono_fijo}</td>#}
{#                        <td style="width: 45px;"> <button type="button"#}
{#                            class="btn btn-outline-danger btn-sm borrar" title="Eliminar" nombre-solicitante="${nombre}">#}
{#                            <i class="fa fa-minus-circle"></i>#}
{#                        </button>#}
{#                        </td#}
{#                        ></tr>`#}
{#                    );#}
{#                    resetFormSolicitud()#}

{#                } else {#}
{#                    alertTemplate('Debe introducir al menos un número de teléfono como contacto del solicitante', 'danger')#}
{#                }#}

{#            }#}
{#        })#}
{#        $('#btnSubbmitInforme').on('click', function (event) {#}
{#            // event.preventDefault()#}
{#            // if (form_factura.valid()) {#}
{#            //     if (lista_mercancias.length) {#}
{#            //         // proceso de facturación#}
{#            //         const listado = JSON.stringify(listado_solicitantes)#}
{#            //         form_factura.append(`<input type="text" hidden name="mercancias" value='${listado}' />`)#}
{#            //         loadingModal.show()#}
{#            //         form_factura.submit()#}
{#            //     } else alertTemplate('Debe existir alguna mercancía o producto para facturar', 'danger')#}
{#            // }#}
{#        })#}

{#        $(document).on('click', '.borrar', function (event) {#}
{#            console.info(lista_mercancias)#}
{#            console.info($(this).attr('nombre-solicitante'))#}
{#            event.preventDefault();#}
{#            lista_mercancias = lista_mercancias.filter(e => e.nombre !== $(this).attr('nombre-solicitante'))#}
{#            $(this).closest('tr').remove()#}
{#        })#}

    </script>
{% endblock %}
